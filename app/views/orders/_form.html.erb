<%= form_with(model: order,
              class: "w-full max-w-md mx-auto",
              data: {
                controller: "order-form",
                order_form_current_price_value: order.stock.current_price,
                turbo_frame: "_top"
              }) do |form| %>

  <!-- Error Messages -->
  <% if order.errors.any? %>
    <div class="mb-6 p-4 bg-[#ef4444]/10 border border-[#ef4444]/20 rounded-lg">
      <h4 class="text-[#ef4444] font-medium mb-2">
        Please fix the following errors:
      </h4>
      <ul class="text-[#ef4444] text-sm space-y-1">
        <% order.errors.each do |error| %>
          <li>â€¢ <%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Header -->
  <div class="text-center mb-6">
    <h2 class="text-2xl font-bold text-gray-900 mb-1">
      <%= order.action&.titlecase %> <%= order.stock.ticker %>
    </h2>
    <p class="text-gray-600">
      <%= number_to_currency(order.stock.current_price) %> per share
    </p>
  </div>

  <!-- Account Info -->
  <div class="grid grid-cols-2 gap-4 mb-6">
    <div class="bg-[#1db8a6]/10 border border-[#1db8a6]/20 p-4 rounded-lg text-center">
      <p class="text-sm text-[#1db8a6] font-medium mb-1">
        Available Cash
      </p>
      <p class="font-semibold text-[#000000]">
        <%= number_to_currency(current_user&.portfolio&.cash_balance) %>
      </p>
    </div>
    <div class="bg-[#a5b4fc]/5 border border-[#a5b4fc]/20 p-4 rounded-lg text-center">
      <p class="text-sm text-[#8b5cf6] font-medium mb-1">
        Shares Owned
      </p>
      <p class="font-semibold text-[#000000]">
        <%= shares_owned %>
      </p>
    </div>
  </div>

  <!-- Shares Input -->
  <div class="mb-6">
    <%= form.label :shares, 
        "Number of shares", 
        class: "block text-sm font-medium text-[#000000] mb-2" %>
    <%= form.number_field :shares, 
        min: 1, 
        step: 1,
        required: true, 
        placeholder: "Enter quantity",
        class: "w-full px-4 py-3 text-lg border-2 border-[#f0f0f0] rounded-lg focus:ring-2 focus:ring-[#a5b4fc] focus:border-[#a5b4fc] outline-none", 
        data: { 
          order_form_target: "shares", 
          action: "input->order-form#calculateTotal" 
        } %>
  </div>

  <!-- Order Total -->
  <div class="mb-6 p-4 bg-[#a5b4fc]/10 border border-[#a5b4fc]/20 rounded-lg">
    <div class="flex justify-between items-center">
      <span class="text-[#000000] font-medium">
        Total <%= order.action == 'buy' ? 'Cost' : 'Proceeds' %>:
      </span>
      <span class="text-xl font-bold text-[#000000]" 
            data-order-form-target="totalCost">
        $0.00
      </span>
    </div>
  </div>

  <!-- Hidden Fields -->
  <%= form.hidden_field :action, value: order.action %>
  <%= form.hidden_field :stock_id, value: order.stock.id %>

  <!-- Submit Button -->
  <div class="flex gap-3">
    <button type="button" 
            class="flex-1 px-4 py-3 border border-[#f0f0f0] text-[#737373] font-medium rounded-lg hover:bg-[#f0f0f0]/50 transition-colors cursor-pointer"
            data-action="click->modal#close">
      Cancel
    </button>
    <%= form.submit "#{order.action == 'buy' ? 'Buy' : 'Sell'} Shares", 
        class: "flex-1 px-4 py-3 #{order.action == 'buy' ? 'bg-[#1db8a6] hover:bg-[#1db8a6]/90' : 'bg-[#F59E0B] hover:bg-[#F59E0B]/90'} text-white font-medium rounded-lg transition-colors shadow-sm cursor-pointer" %>
  </div>

<% end %>